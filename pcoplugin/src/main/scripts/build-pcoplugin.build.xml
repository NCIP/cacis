<?xml version="1.0"?>
<project xmlns="antlib:org.apache.tools.ant">

    <property file="${basedir}/local.properties"/>
    <property file="${basedir}/default.properties"/>

    <property name="buildFolder" value="${basedir}/build"/>

    <property name="common.antfiles.dir" value="${basedir}/common/antfiles"/>
    <property name="common.tolven.antfiles.dir" value="${basedir}/common/antfiles/tolven"/>

    <property name="src.manifest.dir" value="${basedir}/manifest"/>

    <property name="build.dir" value="${basedir}/build"/>
    <property name="build.classes.dir" value="${build.dir}/classes"/>
    <!-- Using jars directory as we do not have a war file -->
    <property name="target.dir" value="${build.dir}"/>

    <property name="ext.dir" value="${basedir}/ext"/>
    <property name="ext.compile.dir" value="${ext.dir}/compile"/>
    <property name="ext.compile.jars.dir" value="${ext.compile.dir}"/>


    <property name="includeSourceInDevLib" value="true"/>

    <import file="${common.antfiles.dir}/build-common.xml"/>
    <import file="${common.tolven.antfiles.dir}/buildCommon.xml"/>
    <import file="${common.tolven.antfiles.dir}/buildImport.xml"/>

    <path id="compile.cp">
        <fileset dir="${ext.compile.jars.dir}">
            <include name="*.jar"/>
        </fileset>
    </path>

    <target name="clean" description="Clean the build artifacts">
    	<delete dir="${build.dir}"/>
        <delete dir="${reports.dir}"/>
    </target>

    <!--
    	The "build-plugin" target builds one or more sections, each section consisting of a source directory and
    	any other files needed by the manifest/tolven-plugin.xml. You are free to remove any sections that you don't use
    	and add sections if needed. In any case, the folders (sections) mentioned here should correspond to the filters
    	mentioned in the manifest.
    	-->
	<target name="build-plugin" depends="init, build" description="Build all sections of this plugin">
	    <echo message="Inside of build plugin. Build Folder: ${buildFolder} ${zipFileName}" />
		<zip destfile="${buildFolder}/${zipFileName}" >
			<!-- Add Manifest section -->
			<zipfileset dir="${src.manifest.dir}"/>
		</zip>
		<!-- Begin list of sections to build. Each section is added to the plugin zip file. -->
		<antcall target="buildSection" inheritrefs="true">
			<param name="section" value="app"/>
		</antcall>
		<!-- End of list of sections to build -->
		<!-- Add DevLib.jar to plugin zip -->
		<zip destfile="${buildFolder}/${zipFileName}" update="true">
			<zipfileset dir="${buildFolder}">
				<include name="devLib.jar"/>
			</zipfileset>
		</zip>
	</target>

    <target name="build" depends="ivy:setup"
                description="Compiles all production source code and assembles artifacts."/>

    <target name="build-pcoplugin" depends="clean,ivy:clean,deploy-to-local-repository"/>

</project>